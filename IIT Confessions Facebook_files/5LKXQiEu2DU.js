/*1359522342,173213983*/

if (self.CavalryLogger) { CavalryLogger.start_js(["Xta22"]); }

__d("TimelineScrubber",["event-extensions","CSS","DOM","Input","Keys","Parent","TimelineController","Vector","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('CSS'),h=b('DOM'),i=b('Input'),j=b('Keys'),k=b('Parent'),l=b('TimelineController'),m=b('Vector'),n=b('copyProperties');function o(p){this._root=p;this._navKeys={};this._subNavKeys={};this._rollups={};this._rolledup={};var q=p.childNodes;this._currentNav=q[0];for(var r=0;r<q.length;r++){var s=q[r].getAttribute('data-key');this._navKeys[s]=q[r];var t=h.scry(q[r],'ul');this._subNavKeys[s]={};if(t.length){var u=t[0].childNodes;for(var v=0;v<u.length;v++)this._subNavKeys[s][u[v].getAttribute('data-key')]=u[v];}var w=q[r].getAttribute('data-rollup');if(w){this._rollups[w]=this._rollups[w]||[];this._rollups[w].push(q[r]);}}this._clickListener=Event.listen(this._root,'click',this._handleScrub.bind(this));this._focusHandler=Event.listen(this._root,'keydown',this._moveFocus.bind(this));this._tabbableElement=h.scry(this._root,'a')[0];g.show(this._root);var x=m.getViewportDimensions().y-this.SCRUBBER_NO_ADS_VERTICAL_BUFFER,y=this.getHeight();if(y>x)this.fold(y-x);l.register(l.SCRUBBER,this);l.scrubberHasLoaded(this);}n(o.prototype,{KEY_HEIGHT:23,SUBKEY_HEIGHT:16,OFFSET:38,SCRUBBER_NO_ADS_VERTICAL_BUFFER:125,reset:function(){this._root=null;this._navKeys={};this._subNavKeys={};this._rollups={};this._rolledup={};},getRoot:function(){return this._root;},getNav:function(p){return this._navKeys[p];},getSubnav:function(p,q){return this._subNavKeys[p][q];},getHeight:function(){return this._root.offsetHeight;},getLabelForNav:function(p){var q=this.getNav(p);return q&&h.getText(h.scry(q,'a')[0]);},getLabelForSubnav:function(p,q){var r=this.getSubnav(p,q);return r&&h.getText(h.scry(r,'a')[0]);},fold:function(p){return this._adjustFolding(p,true);},unfold:function(p){return this._adjustFolding(p,false);},getOffset:function(){return this.OFFSET+(g.hasClass(document.body,'hasVoiceBar')?26:0)+(g.hasClass('rightColContent','pagesTimelineRightColumn')?48:0);},updateSection:function(p,q){var r=this._navKeys[p].getAttribute('data-rollup');if(this._currentRollup&&this._currentRollup!=r){g.removeClass(this._currentRollup,'selected');g.removeClass(h.scry(this._currentRollup,'ul')[0],'loaded');delete this._currentRollup;}if(r&&this._rolledup[r]){var s=this._rolledup[r];if(s.getAttribute('data-rollup')){this._currentRollup=s;g.addClass(this._currentRollup,'selected');g.addClass(h.scry(this._currentRollup,'ul')[0],'loaded');}}this._currentNav&&g.removeClass(this._currentNav,'selected');this._currentSubNav&&g.removeClass(this._currentSubNav,'selected');this._currentNav=null;this._currentSubNav=null;if(this._navKeys[p]){this._currentNav=this._navKeys[p];g.addClass(this._currentNav,'selected');if(this.decadesAreSelectable&&this._navKeys[q]){this._currentSubNav=this._navKeys[q];g.addClass(this._currentSubNav,'selected');}else if(q&&this._subNavKeys[p][q]){this._currentSubNav=this._subNavKeys[p][q];g.addClass(this._currentSubNav,'selected');}}},_getRollupSize:function(p){var q=this._currentNav,r=q&&q.getAttribute('data-rollup'),s=this.KEY_HEIGHT*(this._rollups[p].length-1);if(p==r){s+=this.SUBKEY_HEIGHT*h.scry(q,'li').length;s-=this.SUBKEY_HEIGHT*(this._rollups[p].length-1);}return s;},_adjustFolding:function(p,q){var r=p,s=Object.keys(this._rollups);while(p>0&&s.length){var t=s[q?'pop':'shift']();if(!q==!this._rolledup[t])continue;var u=this._getRollupSize(t);if(u<=0)continue;if(!q&&u>p)break;this[q?'_collapseRollup':'_expandRollup'](t);p-=u;}return r-p;},_collapseRollup:function(p){var q=this._rollups[p];if(!q||q.length<2||this._rolledup[p])return;var r=q[0].previousSibling,s=q[0],t=h.create('a',{href:s.firstChild.href,rel:'ignore',tabindex:'-1'},[p]),u=h.create('ul',{className:'clearfix'});for(var v=0;v<q.length;v++)u.appendChild(q[v]);var w=h.create('li',null,[t,u]);if(this.decadesAreSelectable){var x=q[q.length-1],y=s.getAttribute('data-key')+x.getAttribute('data-key');w.setAttribute('data-start',x.getAttribute('data-start'));w.setAttribute('data-end',s.getAttribute('data-end'));w.setAttribute('data-key',y);this._navKeys[y]=w;}else w.setAttribute('data-key',s.getAttribute('data-key'));w.setAttribute('data-rollup',p);if(r){h.insertAfter(r,w);}else h.prependContent(this._root,w);this._rolledup[p]=w;this._checkSelection();this._ensureFocusableElementIsVisible();},_expandRollup:function(p){if(!this._rolledup[p])return;var q=this._rolledup[p],r=h.scry(q,'ul')[0],s=document.createDocumentFragment();while(r.childNodes.length)s.appendChild(r.firstChild);h.replace(q,s);this._rolledup[p]=false;this._checkSelection();},_checkSelection:function(){if(this._currentNav){var p=this._currentSubNav&&this._currentSubNav.getAttribute('data-key');this.updateSection(this._currentNav.getAttribute('data-key'),p);}},_handleScrub:function(event){var p=event.getModifiers();if(event.isMiddleClick()||p.access||p.meta)return true;var q=k.byTag(event.getTarget(),'a'),r=q&&k.byAttribute(q,'data-key');if(r){l.scrubberWasClicked(r.getAttribute('data-key'));l.navigateToSection(r.getAttribute('data-key'));return event.prevent();}},_ensureFocusableElementIsVisible:function(){while(!(this._tabbableElement.offsetHeight||this._tabbableElement.offsetWidth)){this._tabbableElement.tabIndex=-1;var p=k.byTag(k.byTag(this._tabbableElement,'li'),'li');this._tabbableElement=h.scry(p,'a')[0];this._tabbableElement.tabIndex=0;}},_moveFocus:function(event){if(event.getModifiers().any)return;var p=Event.getKeyCode(event);if(p===j.UP||p===j.DOWN){var q=h.scry(this._root,'a').filter(function(t){return t.offsetHeight||t.offsetWidth;}),r=q.indexOf(this._tabbableElement);if(r!=-1){var s=q[r+(p===j.UP?-1:1)];if(s){s.tabindex=0;i.focus(s);this._tabbableElement.tabindex=-1;this._tabbableElement=s;event.prevent();}}}}});e.exports=o;});
__d("TimelineMainScrubber",["Arbiter","Class","CSS","DOMQuery","TimelineConstants","TimelineController","TimelineScrubber","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('Class'),i=b('CSS'),j=b('DOMQuery'),k=b('TimelineConstants'),l=b('TimelineController'),m=b('TimelineScrubber'),n=b('copyProperties');function o(p){this.parent.construct(this,p);this._subscribe=g.subscribe(k.SECTION_LOADED,function(q,r){var s=this._navKeys[r.key],t=s&&j.scry(s,'ul')[0];if(t){i.addClass(t,'loaded');l.scrubberHasChangedState();if(r.hideSubSections)i.hide(t);}}.bind(this));}h.extend(o,m);n(o.prototype,{reset:function(){this.parent.reset();this._subscribe&&this._subscribe.unsubscribe();}});e.exports=o;});
__d("legacy:TimelineMainScrubber",["TimelineMainScrubber"],function(a,b,c,d){a.TimelineMainScrubber=b('TimelineMainScrubber');},3);
__d("ComposerXEmptyAttachment",["Class","ComposerXAttachment","copyProperties"],function(a,b,c,d,e,f){var g=b('Class'),h=b('ComposerXAttachment'),i=b('copyProperties');function j(k,l){this.parent.construct(this);this._root=k;if(l)this.attachmentClassName=l;}g.extend(j,h);i(j.prototype,{getRoot:function(){return this._root;}});e.exports=j;});
__d("TimelineStickyHeaderComposerX",["event-extensions","Arbiter","Bootloader","CSS","ComposerXController","DOMQuery","Parent","Run","TimelineComposerUtilities","TimelineContentLoader","TimelineStickyHeader","Vector","copyProperties","csx","cx"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Arbiter'),h=b('Bootloader'),i=b('CSS'),j=b('ComposerXController'),k=b('DOMQuery'),l=b('Parent'),m=b('Run'),n=b('TimelineComposerUtilities'),o=b('TimelineContentLoader'),p=b('TimelineStickyHeader'),q=b('Vector'),r=b('copyProperties'),s=b('csx'),t=b('cx');function u(w){return w&&l.byClass(w.getContext(),"-cx-PRIVATE-fbTimelineStickyHeaderComposer__root");}function v(w){this._composerRoot=w;this._tokens=[n.listenToSetEstimatedDate(this._composerRoot,o.capsuleForCurrentSection),n.listenToPublish(this._composerRoot,this._close.bind(this)),g.subscribe('PhotoSnowlift.OPEN',this._close.bind(this)),g.subscribe('TimelineMLE/mleFlyoutShown',function(x,y){if(u(y)===this._composerRoot)j.reset(this._composerRoot);}.bind(this)),g.subscribe('composer/initializedAttachment',function(x,y){if(y.composerRoot===this._composerRoot){this._registerClickToDismiss();if(!y.isInitial)this._closeMLE();}else this._close();}.bind(this)),g.subscribe(p.ADJUST_WIDTH,this._toggleNarrowMode.bind(this))];this._clickCancelToken=n.listenToCancel(this._composerRoot,this._close.bind(this));m.onLeave(function(){while(this._tokens.length)this._tokens.pop().unsubscribe();this._clearClickDismissToken();if(this._clickCancelToken){this._clickCancelToken.remove();this._clickCancelToken=null;}}.bind(this));}r(v.prototype,{_toggleNarrowMode:function(event,w){h.loadModules(['Tooltip'],function(x){var y=q.getElementDimensions(w).x>400,z=k.scry(this._composerRoot,".-cx-PUBLIC-fbComposerAttachment__link");i.conditionClass(this._composerRoot,"-cx-PRIVATE-fbTimelineStickyHeaderComposer__narrow",y);for(var aa=0;aa<z.length;aa++){var ba=z[aa],ca=k.getText(ba);if(y){x.set(ba,ca);}else x.remove(ba);}}.bind(this));return false;},_registerClickToDismiss:function(){var w=i.hasClass(k.find(this._composerRoot,".-cx-PRIVATE-fbComposerAttachment__mle"),"-cx-PRIVATE-fbComposerAttachment__selected");if(!w){this._clearClickDismissToken();return;}this._clickDismissToken=Event.listen(document.body,'click',function(x){var y=l.byClass(x.getTarget(),"-cx-PRIVATE-fbTimelineStickyHeaderComposer__root");if(!y){this._close();this._clearClickDismissToken();}}.bind(this));},_clearClickDismissToken:function(){if(this._clickDismissToken){this._clickDismissToken.remove();this._clickDismissToken=null;}},_close:function(){this._clearClickDismissToken();this._closeMLE();j.reset(this._composerRoot);},_closeMLE:function(){h.loadModules(['TimelineMLE'],function(w){var x=w.getFlyout();if(u(x)===this._composerRoot)w.hideFlyout();}.bind(this));}});e.exports=v;});
__d("ContainerDimensionsUtils",["event-extensions","Style","Vector","EagleEye","DOM"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Style'),h=b('Vector'),i=b('EagleEye'),j=b('DOM');f.onDimensionsReady=function(k,l){var m=j.scry(k,'img.img'),n=m.length;if(n){var o=function(){--n;if(!n)l.defer();};m.forEach(function(p){if(p.complete){o();}else Event.listen(p,{load:o,error:o,abort:o});});}else l.defer();};f.log=function(k,l,m,n){var o=k.parentNode;if(o)f.onDimensionsReady(o,function(){var p=h.getElementDimensions(o),q=h.getElementPosition(o),r=parseInt(g.get(o,'marginBottom'),10);i.log(l,[n,p.x,p.y+r,q.x,q.y,m]);});};});