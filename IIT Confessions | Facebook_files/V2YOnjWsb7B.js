/*1359522342,173217823*/

if (self.CavalryLogger) { CavalryLogger.start_js(["UEnuZ"]); }

__d("legacy:ad-logging",["Arbiter","AsyncRequest","collectDataAttributes","UFITrackingNodes"],function(a,b,c,d){var e=b('Arbiter'),f=b('AsyncRequest'),g=b('collectDataAttributes'),h=b('UFITrackingNodes'),i={};function j(m){return (m.getAttribute&&(m.getAttribute('ajaxify')||m.getAttribute('data-endpoint'))||m.action||m.href||m.name);}function k(m,n){var o=m.ei||m.ai;if(m!==null&&typeof(o)==="string"){if(m.tn){var p=m.tn.charAt(0),q=h.decodeTrackingInfo(p);if((q==h.types.LIKE_LINK)||(q==h.types.UNLIKE_LINK)||(q==h.types.COMMENT)||(q==h.types.ADD_COMMENT_BOX))return;}var r=Date.now(),s=500;m.duplicate_click=!!i[o]&&(r-i[o]<s);i[o]=r;new f('/ajax/ssinfeed/end/').setData(m).setAllowCrossPageTransition(true).setMethod('POST').send();}}function l(m,n){if(!n.node)return;var o=j(n.node);if(!o||!n.event||n.event.type!=='click')return;var p=g(n.node,['ft','ad']);p.ft.href=o;k(p.ft,p.ad);}e.subscribe("ClickRefAction/new",l);},3);
__d("legacy:UIControllerRegistry",[],function(a,b,c,d){a.__UIControllerRegistry=a.__UIControllerRegistry||{};},3);
function HomeNavigationCache(a,b){this.parent.construct(this,a,b,['NavigationMessage.FAVORITES_UPDATED']);}Class.extend(HomeNavigationCache,'PageletCacheController');copyProperties(HomeNavigationCache.prototype,{handlePageletDOMOnSnapshot:function(a){var b=DOM.scry(a,'li.sideNavItem');if(b.length===0)return;for(var c=0;c<b.length;c++){var d=b[c];if(d.id=='navItem_app_4748854339'){CSS.addClass(d,'selectedItem');}else if(CSS.hasClass(d,'selectedItem')){CSS.removeClass(d,'selectedItem');CSS.removeClass(d,'open');}CSS.removeClass(d,'loading');}var e=DOM.scry(a,'.uiFutureSideNav')[0];if(e)CSS.addClass(e,'hideNavCounts');}});
__d("Base64",[],function(a,b,c,d,e,f){var g='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';function h(l){l=(l.charCodeAt(0)<<16)|(l.charCodeAt(1)<<8)|l.charCodeAt(2);return String.fromCharCode(g.charCodeAt(l>>>18),g.charCodeAt((l>>>12)&63),g.charCodeAt((l>>>6)&63),g.charCodeAt(l&63));}var i='>___?456789:;<=_______'+'\0\1\2\3\4\5\6\7\b\t\n\13\f\r\16\17\20\21\22\23\24\25\26\27\30\31'+'______\32\33\34\35\36\37 !"#$%&\'()*+,-./0123';function j(l){l=(i.charCodeAt(l.charCodeAt(0)-43)<<18)|(i.charCodeAt(l.charCodeAt(1)-43)<<12)|(i.charCodeAt(l.charCodeAt(2)-43)<<6)|i.charCodeAt(l.charCodeAt(3)-43);return String.fromCharCode(l>>>16,(l>>>8)&255,l&255);}var k={encode:function(l){l=unescape(encodeURI(l));var m=(l.length+2)%3;l=(l+'\0\0'.slice(m)).replace(/[\s\S]{3}/g,h);return l.slice(0,l.length+m-2)+'=='.slice(m);},decode:function(l){l=l.replace(/[^A-Za-z0-9+\/]/g,'');var m=(l.length+3)&3;l=(l+'AAA'.slice(m)).replace(/..../g,j);l=l.slice(0,l.length+m-3);try{return decodeURIComponent(escape(l));}catch(n){throw new Error('Not valid UTF-8');}},encodeObject:function(l){return k.encode(JSON.stringify(l));},decodeObject:function(l){return JSON.parse(k.decode(l));},encodeNums:function(l){return String.fromCharCode.apply(String,l.map(function(m){return g.charCodeAt((m|-(m>63))&-(m>0)&63);}));}};e.exports=k;});
__d("legacy:base64",["Base64"],function(a,b,c,d){a.Base64=b('Base64');},3);
__d("legacy:DOMPosition",["DOMPosition"],function(a,b,c,d){var e=b('DOMPosition');a.DOMPosition=e;},3);
var NewHigh={reset:function(){this.initialized=false;},ensureInitialized:function(){if(this.initialized)return;this.button=DOM.scry(document.body,'a.stream_header_button')[0];this.composer=DOM.scry(document.body,'div.UIComposer')[0];this.buttonArea=DOM.scry(this.composer,'div.UIComposer_ButtonArea')[0];this.initialized=true;},showComposer:function(a){this.ensureInitialized();if(this.composer){CSS.show(this.composer);UIComposer.focusInstance(this.composer.id);var b=UIComposer.getInstance(this.composer.id);b&&b.loadAttachment(parseInt(a,10));}this.button&&CSS.hide(this.button);},hideComposer:function(a){this.ensureInitialized();if(this.composer){var b=UIComposer.getInstance(this.composer.id);if(!a){b&&b.initialized&&b.blur();CSS.hide(this.composer);this.button&&CSS.show(this.button);}else{b&&b.initialized&&b.loadAttachment(0);CSS.show(this.composer);this.buttonArea&&CSS.hide(this.buttonArea);}}}};
__d("UIIntentionalStreamRefresh",["Arbiter","LiveTimer","Run","UIIntentionalStreamMessage","UserActivity","coalesce","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('LiveTimer'),i=b('Run'),j=b('UIIntentionalStreamMessage'),k=b('UserActivity'),l=b('coalesce'),m=b('copyProperties');function n(o,p){this.isAutoRefreshing=false;this.lastRefresh=Date.now();n.instance=this;this.setAutoRefreshConfig(o);this.updateConfigHandler=g.subscribe(j.UPDATE_AUTOREFRESH_CONFIG,this.updateAutoRefreshConfig.bind(this));this.updateRefreshTimeHandler=g.subscribe(j.UPDATE_LAST_REFRESH_TIME,this.updateLastRefreshTime.bind(this));i.onLeave(this.unload.bind(this));this.userActivity();this.uaToken=k.subscribe(this.userActivity.bind(this));this.autoRefreshInterval=setInterval(this.checkAutoPageRefresh.bind(this),this.checkAutoRefreshTimeInterval);this.activeRefreshInterval=setInterval(this.checkActiveRefresh.bind(this),this.checkActiveRefreshTimeInterval);this.enableAutoRefresh(p);g.subscribe(j.UPDATE_STREAM,h.loop.bind(h,true));g.subscribe(j.REFRESH_STREAM,h.loop.bind(h,true));}m(n,{DISABLE_AUTOREFRESH_TIME:4*60*1000,CHECK_AUTOREFRESH_INTERVAL:5*60*1000,AUTOREFRESH_INACTIVE_TIME:30*60*1000,CHECK_ACTIVE_REFRESH_TIME:5*60*1000,ACTIVE_REFRESH_TIME:30*1000});m(n.prototype,{updateAutoRefreshConfig:function(o,p){if(o==j.UPDATE_AUTOREFRESH_CONFIG)this.setAutoRefreshConfig(p);},updateLastRefreshTime:function(o){if(o==j.UPDATE_LAST_REFRESH_TIME)this.lastRefresh=Date.now();},setAutoRefreshConfig:function(o){o=o||{};var p=24*60*60*1000;if(!this.storyInterval)this.storyInterval=l(o.story_interval,null);this.allowAutoRefresh=l(o.allow_auto_refresh,false);this.inactiveThreshold=l(o.inactive_threshold,0);this.activeRefreshTime=l(o.fast_refresh_rate,p);this.inactiveRefreshTime=l(o.slow_refresh_rate,p);this.allowPolling=l(o.allow_polling,false);this.refreshFactor=l(o.refresh_factor,10);this.minRefreshInterval=l(o.min_refresh_interval,60*1000);this.activeRefresh=l(o.active_refresh,false);this.checkActiveRefreshTimeInterval=l(o.check_active_refresh_interval,n.CHECK_ACTIVE_REFRESH_TIME);this.activeRefreshTimeInterval=l(o.active_refresh_interval,n.ACTIVE_REFRESH_TIME);this.disableAutoRefreshTime=l(o.disable_autorefresh_time,n.DISABLE_AUTOREFRESH_TIME);this.checkAutoRefreshTimeInterval=l(o.check_autorefresh_time_interval,n.CHECK_AUTOREFRESH_INTERVAL);this.autoRefreshInactiveTime=l(o.autorefresh_inactive_time,n.AUTOREFRESH_INACTIVE_TIME);return this;},unload:function(){this.enableAutoRefresh(false);this.cleanupRefreshInterval();k.unsubscribe(this.uaToken);this.updateConfigHandler&&this.updateConfigHandler.unsubscribe();this.updateRefreshTimeHandler&&this.updateRefreshTimeHandler.unsubscribe();},userActivity:function(){var o=this.isInactive();this.lastActivity=Date.now();this.isAutoRefreshing=true;if(o&&this.canAutoRefresh())this.runAutoRefresh();return true;},isInactive:function(){return this.getMSSinceLastActivity()>this.inactiveThreshold;},getMSSinceLastActivity:function(){return Date.now()-this.lastActivity;},getMSSinceLastRefresh:function(){return Date.now()-this.lastRefresh;},getRefreshInterval:function(){if(this.isInactive()){return this.inactiveRefreshTime;}else if(this.storyInterval!=null){var o=this.storyInterval*this.refreshFactor;return Math.max(o,this.activeRefreshTime);}else return this.activeRefreshTime;},canAutoRefresh:function(){return this.isAutoRefreshing&&this.allowAutoRefresh;},cancelUpdate:function(){if(this.updateTask){clearTimeout(this.updateTask);this.updateTask=null;}},runUpdatePoll:function(){this.updateTask=null;if(this.canAutoRefresh())this.runAutoRefresh();},runAutoRefresh:function(){var o=50;if(this.getMSSinceLastRefresh()>=this.minRefreshInterval-o)g.inform(j.UPDATE_STREAM);this.schedulePoll(this.getRefreshInterval());},schedulePoll:function(o){this.cancelUpdate();if(this.allowPolling)this.updateTask=setTimeout(this.runUpdatePoll.bind(this),o);},enableAutoRefresh:function(o,p){this.isAutoRefreshing=o;if(o){var q=p?0:this.getRefreshInterval();this.schedulePoll(q);}else this.cancelUpdate();},checkAutoPageRefresh:function(){if(!this.allowAutoRefresh)return;if(this.isAutoRefreshing&&(this.getMSSinceLastActivity()>this.disableAutoRefreshTime))this.isAutoRefreshing=false;if(this.getMSSinceLastRefresh()<this.autoRefreshInactiveTime)return;var o=this.getMSSinceLastActivity();if(o>this.autoRefreshInactiveTime)g.inform(j.REFRESH_STREAM,{});},checkActiveRefresh:function(){if(!this.allowAutoRefresh)return;if(this.getMSSinceLastRefresh()<this.activeRefreshTimeInterval)return;if(this.getMSSinceLastActivity()<this.activeRefreshTimeInterval)g.inform(j.UPDATE_STREAM);},cleanupRefreshInterval:function(){if(this.autoRefreshInterval){clearInterval(this.autoRefreshInterval);this.autoRefreshInterval=null;}if(this.activeRefreshInterval){clearInterval(this.activeRefreshInterval);this.activeRefreshInterval=null;}}});e.exports=n;});
__d("UIIntentionalStream",["event-extensions","Animation","Arbiter","AsyncRequest","AsyncResponse","CSS","DataStore","DOM","DOMScroll","HTML","JSLogger","NavigationMessage","OnVisible","PageTransitions","Run","ScrollAwareDOM","Style","UIIntentionalStreamMessage","UIIntentionalStreamRefresh","UIPagelet","URI","Vector","$","clickRefAction","coalesce","copyProperties","createArrayFrom","ge","isEmpty","merge","reportData","startsWith","userAction"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Animation'),h=b('Arbiter'),i=b('AsyncRequest'),j=b('AsyncResponse'),k=b('CSS'),l=b('DataStore'),m=b('DOM'),n=b('DOMScroll'),o=b('HTML'),p=b('JSLogger'),q=b('NavigationMessage'),r=b('OnVisible'),s=b('PageTransitions'),t=b('Run'),u=b('ScrollAwareDOM'),v=b('Style'),w=b('UIIntentionalStreamMessage'),x=b('UIIntentionalStreamRefresh'),y=b('UIPagelet'),z=b('URI'),aa=b('Vector'),ba=b('$'),ca=b('clickRefAction'),da=b('coalesce'),ea=b('copyProperties'),fa=b('createArrayFrom'),ga=b('ge'),ha=b('isEmpty'),ia=b('merge'),ja=b('reportData'),ka=b('startsWith'),la=b('userAction');function ma(){h.subscribe(w.SET_AUTO_INSERT,na);}function na(pa,qa){if(pa!=w.SET_AUTO_INSERT)return;var ra=oa.instance;if(ra)ra.pauseAutoInsert=qa.pause;}function oa(pa,qa,ra,sa,ta,ua,va,wa,xa,ya,za){if(!pa)throw new Error('UIIntentionalStream instantiated with no root.');var ab={};this.initPageletCache(ab);ea(this,{id:pa.id,root:pa,instanceName:qa,newest:ab.newest||ra,oldest:sa,oldestMR:sa,shouldShowHidden:false,defaultFilter:ta,currentFilterKey:ya,sourceType:ua,lastSeenTime:za,hasPendingRefresh:false,pauseAutoInsert:false,error:m.scry(pa,'div.UIIntentionalStream_Error')[0],pager:m.scry(pa,'div.uiMorePager')[0],filterNullState:m.scry(pa,'div.friendListFilterNullState')[0],streamContent:m.find(pa,'.UIIntentionalStream_Content'),requestNum:0,scrollLoadCount:1,maxScrollLoadCount:1,scrollPosition:0,lastViewStateID:0,cachedScrollQID:0,jslog:p.create('stream'),scrollListener:null});this.addScrollTrace('init',{});t.onLeave(this.unload.bind(this));if(!oa.instances)oa.instances={};oa.instances[qa]=this;oa.instance=this;ma();this.setupSubscriptions();}ea(oa.prototype,{initPageletCache:function(pa){if(window.PageletCacheController){this._cache=window.PageletCacheController.registerController('pagelet_home_stream',this);if(this._cache){ea(pa,this._cache.loadData());this._cache.registerCleanup(w.UNLOAD);}}},subscribeToComposerPublish:function(){this.subscriptions.push(h.subscribe('composer/publish',function(event,pa){if(pa.streamStory)this.addComposerContent(pa.streamStory,500);}.bind(this)));},setupSubscriptions:function(){this.subscriptions=[];this.subscribeToComposerPublish();this.subscriptions.push(h.subscribe(w.UPDATE_STREAM,this.updateStream.bind(this)));this.subscriptions.push(h.subscribe(w.REFRESH_STREAM,this.refreshStream.bind(this)));this.scrollListener=Event.listen(window,'scroll',this.checkFirstScroll.bind(this));this.checkFirstScroll();t.onLoad(this.checkFirstStory.bind(this));},tearDownSubscriptions:function(){if(!this.subscriptions)return;this.subscriptions.forEach(h.unsubscribe);this.subscriptions=null;if(this.scrollListener){this.scrollListener.remove();this.scrollListener=null;}},unload:function(){this.addScrollTrace('unload',{});h.inform(w.UNLOAD);this.tearDownSubscriptions();oa.instance=null;oa.instances[this.instanceName]=null;this.clearScrollLoader(true);window.disableScrollLoad=null;x.instance&&x.instance.unload();},_getUpdateInsertType:function(){return oa.REFRESH_PREPEND;},updateStream:function(pa){if(pa!=w.UPDATE_STREAM||this.hasPendingRefresh||this.isAutoRefreshPaused())return;this.loadNewer({showLoader:false,ignoreSelf:true,insertType:this._getUpdateInsertType()});},clearScrollLoader:function(pa){if(this.currentScrollListener){this.currentScrollListener.remove();this.currentScrollListener=null;}if(pa||this.scrollLoadCount>=this.maxScrollLoadCount)window.disableScrollLoad=true;},loadOlderPosts:function(pa){var qa={filter:this.getCurrentFilterKey(),oldest:this.oldest,oldestMR:this.oldestMR,last_seen_time:this.lastSeenTime,scroll_count:this.scrollLoadCount,scroll_position:this.scrollPosition,last_viewstate_id:this.lastViewStateID,cached_scroll_qid:this.cachedScrollQID};qa=ia(qa,pa);this.loadWithParams(qa);},loadWithParams:function(pa){var qa=m.scry(this.root,'div.fbStreamPager.hasMorePosts')[0];if(qa){if(k.hasClass(qa,'async_saving'))return;k.addClass(qa,'async_saving');}this.addScrollTrace('loadwithparams',pa);y.loadFromEndpoint('MoreStoriesPagelet','home_stream',pa,{usePipe:true,append:true});},setScrollLoadCount:function(pa){this.maxScrollLoadCount=pa;},loadMoreOnScroll:function(pa,qa){if(window.disableScrollLoad)return;var ra=function(){if(window.disableScrollLoad)return;var ua=a.ArbiterMonitor;if(ua){ca('scroll',null,null,'FORCE',{gt:{ua_id:'stream:scroll:auto'}}).set_namespace('stream');var va=la('stream').uai('scroll','stream:scroll:auto');ua.initUA(va);}var wa={delay_load_count:qa};this.loadOlderPosts(wa);}.bind(this),sa=m.scry(this.root,'ul.uiStream li.genericStreamStory');if(!sa.length)return;this.addScrollTrace('loadmoreonscroll',{});var ta=sa[sa.length-pa-1];if(ta){this.currentScrollListener=new r(ta,ra,null,0);}else ra();},updateTimeRange:function(pa,qa){if(!this.newest||this.newest<pa){this.newest=pa;this.addScrollTrace('update_newest',{newest:this.newest});}if(!this.oldest||(qa&&(qa<this.oldest))){this.oldest=qa;this.addScrollTrace('update_oldest',{oldest:this.oldest});}},updateOldestMR:function(pa){if(!this.oldestMR||pa<this.oldestMR){this.oldestMR=pa;this.addScrollTrace('update_oldestmr',{oldestmr:this.oldestMR});}},updateScrollPosition:function(pa){this.scrollPosition=pa;this.addScrollTrace('update_scrollposition',{scrollposition:this.scrollPosition});},updateLastViewStateID:function(pa){this.lastViewStateID=pa;this.addScrollTrace('update_lastviewstateid',{lastviewstateid:this.lastViewStateID});},updateCachedScrollQID:function(pa){this.cachedScrollQID=pa;this.addScrollTrace('update_cachedscrollqid',{qid:this.cachedScrollQID});},getID:function(){return this.id;},getCurrentFilterKey:function(){if(this.currentFilterKey)return this.currentFilterKey;var pa=z.getMostRecentURI().getQueryData();if(pa&&pa.sk){this.currentFilterKey=pa.sk;}else if(pa&&pa.filter){this.currentFilterKey=pa.filter;}else if(this.defaultFilter)this.currentFilterKey=this.defaultFilter;return this.currentFilterKey;},resetFilterKey:function(pa){this.currentFilterKey=pa;},loadOlder:function(pa){pa=pa||{};if(!this.oldest)return;var qa=this.getCurrentParams();qa.oldest=this.oldest;this.refresh(oa.REFRESH_APPEND,qa,pa);return this;},loadNewer:function(pa){if(!this.newest)return;pa=pa||{};var qa=this.getCurrentParams();qa.newest=this.newest;if(pa.ignoreSelf)qa.ignore_self=true;qa.load_newer=true;var ra=da(pa.insertType,oa.REFRESH_PREPEND);this.refresh(ra,qa,pa);return this;},checkFirstStory:function(){this.logFirstStory('first_story_load');},checkFirstScroll:function(){if(this.scrollListener&&aa.getScrollPosition().y>0){this.scrollListener.remove();this.scrollListener=null;this.logFirstStory('first_scrolling');}},logFirstStory:function(pa){if(!ga('home_stream')||!ga('home_stream').childElementCount||!ga('home_stream').children[0].getAttribute('data-ft'))return;var qa=ga('home_stream').children[0].getAttribute('data-ft'),ra=JSON.parse(qa);if(!(("mf_story_key" in ra)&&("qid" in ra)))return;var sa={mf_story_key:ra.mf_story_key,qid:ra.qid};ja(pa,{ft:sa});},getCurrentParams:function(){var pa={},qa=z.getMostRecentURI().getQueryData();qa.filter=this.getCurrentFilterKey();var ra=this.getValidParams();if(ra){ra.forEach(function(sa){pa[sa]=qa[sa];});}else pa=qa;return pa;},setHomeFilter:function(pa){this._homeFilter=pa;},setHomeFilterLoading:function(pa){if(this._homeFilter)this._homeFilter.setLoading(pa);},refresh:function(pa,qa,ra){h.inform(w.UPDATE_LAST_REFRESH_TIME);this.addScrollTrace('refresh',{type:pa,data:qa,kwargs:ra});this.currentFilterKey=qa.filter;if(qa.filter==oa.FEED_FILTER_KEY_DUAL_NEWS_FEED){this.currentFilterKey=this.defaultFilter;}else if(oa.isHighlightsFilter(qa.filter)||qa.filter===oa.FEED_FILTER_KEY_NEWS_FEED)this.defaultFilter=this.currentFilterKey;ra=ra||{};var sa=++this.requestNum,ta=da(ra.showLoader,true),ua=this.instanceName,va=function(za){oa.getInstance(ua).handleResponse(sa,pa,za,ra);},wa=function(za){oa.getInstance(ua).handleError(sa,pa,za,ra);},xa=function(za){oa.getInstance(ua).handleFinally(pa,qa.filter,za);};if(!(qa.request_type=pa))qa.request_type='none';if(qa.filter){ra.show_hidden=qa.show_hidden?qa.show_hidden:false;}else ra.show_hidden=this.shouldShowHidden;qa=ea(this.getCurrentParams(),qa);this.hasPendingRefresh=true;var ya;if(pa==oa.REFRESH_APPEND&&ta)ya=this.pager;new i().setURI(this.getEndpoint()).setReadOnly(true).setOption('retries',0).setMethod(this.getRefreshMethod()).setData(qa).setHandler(va).setStatusElement(ya).setErrorHandler(wa).setFinallyHandler(xa).send();if(pa==oa.REFRESH_TRANSITION){if(this.pager)this.pager.style.display='none';this.clearScrollLoader();this.oldest=this.newest=null;}if(ta)this.setHomeFilterLoading(true);},addComposerContent:function(pa,qa){if(this.isOnNewsFeedFilter())k.addClass(pa,'uiStreamBoulderHighlight');this.addContentPrepend(pa,qa);},addContentPrepend:function(pa,qa){if(pa.length){fa(pa).reverse().forEach(function(wa){this.addContentPrepend(wa,qa);}.bind(this));return;}var ra,sa=aa.getScrollPosition().y,ta=aa.getElementPosition(this.streamContent).y,ua=this.scrollOnPrepend&&sa>=ta;if(ua){var va=function(wa){var xa=m.find(wa,'^li.uiStreamStory');if(!xa)return;l.set(xa,'origHeight',xa.offsetHeight);Event.listen(wa,'load',function(){var ya=l.get(xa,'origHeight');if(xa.offsetHeight!=ya){window.scrollBy(0,xa.offsetHeight-ya);l.set(xa,'origHeight',xa.offsetHeight);}});};ra=g.insert.curry(this.streamContent,pa,(function(wa,xa){m.prependContent(this.streamContent,xa);h.inform('reflow');window.scrollBy(0,xa.offsetHeight);m.scry(xa,'img').forEach(va);}).bind(this));}else ra=(function(){v.set(pa,'opacity',0);u.prependContent(this.streamContent,pa);h.inform('reflow');new g(pa).from('opacity',0).to('opacity',1).duration(400).ondone(function(){h.inform(w.UPDATE_HTML_CONTENT);}).go();}).bind(this);if(qa){k.hide(pa);m.appendContent(document.body,pa);setTimeout(function(){k.show(pa);ra();},qa);}else ra();},addContentAppend:function(pa){m.appendContent(this.streamContent,pa);},handleResponse:function(pa,qa,ra,sa){this.addScrollTrace('handle_response',{requestnum:pa,type:qa,kwargs:sa});sa=sa||{};var ta=ra.getPayload();this.filterNullState&&m.remove(this.filterNullState);if(ha(ta))return;if(ta.autoRefreshConfig)h.inform(w.UPDATE_AUTOREFRESH_CONFIG,ta.autoRefreshConfig);this.setHomeFilterLoading(false);if(qa==oa.REFRESH_EXPAND){var ua=m.find(ba(sa.expandStoryID),'div.UIIntentionalStory_CollapsedStories');k.hide(ua);k.removeClass(ua,'UIIntentionalStory_CollapsedStoriesLoading');}if(this.error)this.error.style.display='none';if(pa!=this.requestNum)return;if('show_hidden' in sa)this.shouldShowHidden=sa.show_hidden;if('newestStoryTime' in ta&&ta.newestStoryTime>this.newest)this.newest=ta.newestStoryTime;if(qa!=oa.REFRESH_PREPEND){if('oldestStoryTime' in ta&&(!this.oldest||ta.oldestStoryTime<this.oldest))this.oldest=ta.oldestStoryTime;if('scrollPosition' in ta)this.scrollPosition=ta.scrollPosition;if('lastViewStateID' in ta)this.lastViewStateID=ta.lastViewStateID;if('oldestMRStoryTime' in ta)this.oldestMR=ta.oldestMRStoryTime;if('cachedScrollQID' in ta){this.cachedScrollQID=ta.cachedScrollQID;}else this.cachedScrollQID=0;}if(ta.html){var va=o(ta.html).getNodes();switch(qa){case oa.REFRESH_PREPEND:this.addContentPrepend(va);break;case oa.REFRESH_APPEND:this.addContentAppend(va);this.clearScrollLoader(true);break;case oa.REFRESH_TRANSITION:m.setContent(this.streamContent,va);this.scrollLoadCount=1;if(!sa.noScroll)n.scrollTo(new aa(0,0,"document"),false);break;case oa.REFRESH_EXPAND:m.insertAfter(ba(sa.expandStoryID),va);break;case oa.DELAYED_STREAM:this.addContentAppend(va);break;}h.inform(w.UPDATE_HTML_CONTENT);}},handleError:function(pa,qa,ra,sa){if(pa!=this.requestNum)return;this.setHomeFilterLoading(false);var ta=ra.getError();if(ta==1357001)j.defaultErrorHandler(ra);if(qa==oa.REFRESH_EXPAND){var ua=m.find(ba(sa.expandStoryID),'div.UIIntentionalStory_CollapsedStories');k.removeClass(ua,'UIIntentionalStory_CollapsedStoriesLoading');}if(!sa.delayLoadCount&&qa!=oa.REFRESH_PREPEND&&this.error)v.set(this.error,'display','block');},handleFinally:function(pa,qa){if(pa==oa.REFRESH_TRANSITION){s.transitionComplete();h.inform(q.NAVIGATION_COMPLETED);}this.hasPendingRefresh=false;},getValidParams:function(){return oa.VALID_PARAMS;},getEndpoint:function(){return oa.ENDPOINT;},getRefreshMethod:function(){return oa.REFRESH_METHOD;},isOnNewHighlights:function(){var pa=this.getCurrentFilterKey();return (oa.isHighlightsFilter(pa)||(pa==oa.FEED_FILTER_KEY_DUAL_NEWS_FEED&&oa.isHighlightsFilter(this.defaultFilter)));},isLiveStreamBox:function(){var pa=this.getCurrentFilterKey();return pa&&pa.indexOf(oa.FEED_FILTER_KEY_LIVE_STREAM_BOX)===0;},isOnNewsFeedFilter:function(){var pa=this.getCurrentFilterKey();return (pa==oa.FEED_FILTER_KEY_NEWS_FEED||oa.isHighlightsFilter(pa)||pa==oa.FEED_FILTER_KEY_DUAL_NEWS_FEED);},isAutoRefreshPaused:function(){if(this.isOnNewHighlights()||this.isLiveStreamBox())return false;return this.pauseAutoInsert;},addScrollTrace:function(pa,qa){this.jslog.debug(pa,qa);},refreshStream:function(pa,qa){if(pa!=w.REFRESH_STREAM)return;var ra=this.getCurrentFilterKey(),sa={filter:ra},ta={filter:ra};qa.noScroll&&(ta.noScroll=1);this.refresh(oa.REFRESH_TRANSITION,sa,ta);},getNewest:function(){return this.newest;}});ea(oa,{ANIMATION_DURATION:300,REFRESH_METHOD:'GET',REFRESH_TRANSITION:1,REFRESH_PREPEND:2,REFRESH_APPEND:3,REFRESH_EXPAND:5,DELAYED_STREAM:6,FEED_FILTER_KEY_NEW_HIGHLIGHTS:'h',FEED_FILTER_KEY_NEWS_FEED:'lf',FEED_FILTER_KEY_DUAL_NEWS_FEED:'nf',FEED_FILTER_KEY_LIVE_STREAM_BOX:'pub',VALID_PARAMS:['filter','show_hidden'],ENDPOINT:'/ajax/intent.php',getInstance:function(pa){return oa.instances[pa];},isHighlightsFilter:function(pa){if(!pa)return false;return ka(pa,oa.FEED_FILTER_KEY_NEW_HIGHLIGHTS);},getStoriesByAssoc:function(pa){return m.scry(oa.instance.root,'div.aid_'+pa);}});e.exports=oa;});
__d("legacy:UIIntentionalStream",["UIIntentionalStream"],function(a,b,c,d){a.UIIntentionalStream=b('UIIntentionalStream');},3);
__d("legacy:UIPagelet",["UIPagelet"],function(a,b,c,d){a.UIPagelet=b('UIPagelet');},3);
function FutureHomeSideNav(){this.parent.construct(this);}Class.extend(FutureHomeSideNav,'FutureSideNav');copyProperties(FutureHomeSideNav.prototype,{init:function(){this.parent.init.apply(this,arguments);this.ajaxPipe=true;this.seeAllEndpoint="/ajax/home/generic.php";this.typeSections={favorites:'pinnedNav',profiles:'pinnedNav',apps:'appsNav',groups:'groupsNav',pages:'pagesNav',lists:'listsNav',interests:'interestsNav',connect_apps:'connectNav'};this.switchingFromTitanFixedFrame=false;this._arbiterSubscriptions.push(Arbiter.subscribe('titan_fixed_frame_changed',this.handleFixedFrameChanged.bind(this)),Arbiter.subscribe(NavigationMessage.NAVIGATION_FAVORITE_UPDATE,this.updateFavorite.bind(this)),Arbiter.subscribe(NavigationMessage.NAVIGATION_FIRST_RESPONSE,this.navigationFirstResponse.bind(this)));this._ensureHover('homeSideNav');this._initPageletCache();},_initPageletCache:function(a){if(window.PageletCacheController){this._cache=PageletCacheController.registerController('pagelet_navigation',this);if(this._cache){this._cache.registerCleanup('HomeNav/cleanup');onleaveRegister(function(){Arbiter.inform('HomeNav/cleanup');});}}},initMoreLink:function(a){this._eventHandlers.push(Event.listen(a,'click',this._showMoreSections.bind(this,a)));},_showMoreSections:function(a){var b=DOM.scry(this.root,'div.belowThreshold');CSS.hide(a);b.forEach(function(c){CSS.removeClass(c,'belowThreshold');});},handleFixedFrameChanged:function(a,b,c){if(b){var d=function(e,f){var g=DOMPosition.getElementPosition(ge(f)).y;UIPagelet.loadFromEndpoint(e,f,{fixed_frame:b,selected_key:c,v_pos:g});};d('PinnedNavigationPagelet','pagelet_pinned_nav');d('BookmarkNavigationPagelet','pagelet_bookmark_nav');if(ge('chatFriendsOnline'))CSS.hide(ge('chatFriendsOnline'));}else this.switchingFromTitanFixedFrame=true;},handlePageTransition:function(a){if(this.switchingFromTitanFixedFrame){this.switchingFromTitanFixedFrame=false;return false;}else return this.parent.handlePageTransition(a);},_initSection:function(a){var b=this.parent._initSection(a);for(var c in this.typeSections){var d=this.typeSections[c];if(b.id==d){var e=DOM.scry(b.node,'h4.navHeader')[0];if(e){var f='\/bookmarks\/('+c+')(\/)?';b.seeall=this._initItem({node:e,id:b.id,endpoint:this.seeAllEndpoint,key:['bookmarks'],path:[{regex:f}]});}}}return b;},_constructItem:function(a,b){return new FutureHomeSideNavItem(a,b);},_constructSection:function(a){return new FutureHomeSideNavSection(a);},getSection:function(a){return this.typeSections[a]&&this.sections[this.typeSections[a]];},_getItemForKey:function(a){var b=this.parent._getItemForKey("nf");if(b&&b.matchKey(a)){return b;}else return this.parent._getItemForKey(a);},_isCurrentPath:function(a){return ((a.getDomain()===this.uri.getDomain())&&(a.getPath()==='/'||a.getPath()==='/home.php'));},_handleMenuClick:function(a,b,c,event){if(CSS.hasClass(c,'favorite')){Arbiter.inform(NavigationMessage.NAVIGATION_FAVORITE_UPDATE,{key:b.numericKey,favorite:!a.equals(this.getSection("favorites")),movetop:CSS.hasClass(c,'movetop')});}else this.parent._handleMenuClick(a,b,c,event);},removeItemByKey:function(a){Arbiter.inform(NavigationMessage.NAVIGATION_ITEM_REMOVED,a);this.parent.removeItemByKey(a);},toggleItemByKey:function(a,b){var c=this.getNodeForKey(a);if(!b){Arbiter.inform(NavigationMessage.NAVIGATION_ITEM_HIDDEN,a);c&&CSS.hide(c);}else c&&CSS.show(c);var d=this._getItemForKey(a);this.getSection(d.type).refresh();},removeItem:function(a){var b=this.getSection(a.type);this.parent.removeItem(a);b.refresh();},updateFavorite:function(a,b){var c=this._findItem(function(l){return l.matchKey(b.key)&&l.canFavorite();}),d=this.getSection("favorites"),e=emptyFunction,f=b.favorite?d.addEndpoint:d.removeEndpoint;if(b.movetop)f=d.editEndpoint;if(!c&&(b.favorite||b.movetop)){if(b.movetop)var g=DOM.scry(this.root,'.expandableSideNav'),h=g&&g.length&&CSS.hasClass(g[0],'expandedMode');e=function(){UIPagelet.loadFromEndpoint('PinnedNavigationPagelet','pagelet_pinned_nav',{expanded:h});};}else if(!c){e=function(){UIPagelet.loadFromEndpoint('BookmarkNavigationPagelet','pagelet_bookmark_nav');};}else{if(b.movetop){CSS.show(c.node);this.moveItem(d,c);var i=Parent.byClass(c.node,'uiSideNav');if(i&&i.childNodes.length){var j=Parent.byClass(DOM.scry(i,'.sortableItem')[0],'sideNavItem');DOM.insertBefore(j,c.node);CSS.removeClass(c.node,'hidden');}}else{var k=this.getSection(c.type);if(b.favorite){CSS.show(c.node);this.moveItem(d,c);c.showFavorite();}else if(!k.equals(d)){this.moveItem(k,c,true);c.hideFavorite();}else this.removeItem(c);k.refresh();}d.refresh();b.key=c.numericKey;Arbiter.inform('NavigationMessage.FAVORITES_UPDATED');}new AsyncRequest().setURI(f).setData({id:b.key,movetop:b.movetop}).setHandler(e).send();},_doPageTransition:function(a,b){this._unloadStreams();var c=this.parent._doPageTransition(a,b);if(c&&(a.type=='groups'||a.type=='lists'||a.type=='interests')){a.setCount(0);a.hideUnreadDot();}return c;},_unloadStreams:function(){var a=window.UIIntentionalStream&&UIIntentionalStream.instances,b=['nile','global','friends','blade'];a&&b.forEach(function(c){a[c]&&a[c].unload();});},navigationFirstResponse:function(){this.setSelected(this.loading);}});function FutureHomeSideNavSection(a){this.parent.construct(this,a);this.editEndpoint='/ajax/bookmark/edit/';this.addEndpoint='/ajax/bookmark/add/';this.removeEndpoint='/ajax/bookmark/delete/';}Class.extend(FutureHomeSideNavSection,'FutureSideNavSection');copyProperties(FutureHomeSideNavSection.prototype,{refresh:function(){var a=DOM.scry(this.node,'li.sideNavItem'),b=DOM.scry(this.node,'div.actionLinks'),c=a.some(CSS.shown);CSS.conditionShow(DOM.find(this.node,'h4.navHeader'),c);b.length&&CSS.conditionShow(b[0],c);}});function FutureHomeSideNavItem(a,b){this.parent.construct(this,a,b);}Class.extend(FutureHomeSideNavItem,'FutureSideNavItem');copyProperties(FutureHomeSideNavItem.prototype,{canFavorite:function(){return !!this._getFavoriteLabel();},showFavorite:function(){DOM.setContent(this._getFavoriteLabel(),"Remove from Favorites");},hideFavorite:function(){DOM.setContent(this._getFavoriteLabel(),"Add to Favorites");},hideUnreadDot:function(){var a=DOM.scry(this.node,'img.unreadDot')[0];a&&CSS.hide(a);},_getFavoriteLabel:function(){return DOM.scry(this.node,'li.favorite span.itemLabel')[0];}});
__d("FeedKeyboardController",["event-extensions","$","Arbiter","CSS","DOM","DOMScroll","DOMQuery","Input","Keys","NavigationMessage","Parent","Run","Style","UserAgent","Vector","ViewportBounds","copyProperties","ge","throttle"],function(a,b,c,d,e,f){b('event-extensions');var g=b('$'),h=b('Arbiter'),i=b('CSS'),j=b('DOM'),k=b('DOMScroll'),l=b('DOMQuery'),m=b('Input'),n=b('Keys'),o=b('NavigationMessage'),p=b('Parent'),q=b('Run'),r=b('Style'),s=b('UserAgent'),t=b('Vector'),u=b('ViewportBounds'),v=b('copyProperties'),w=b('ge'),x=b('throttle');n.J=74;n.K=75;n.L=76;n.C=67;var y;function z(ba){this.root=ba;this.init();}function aa(){y=i.hasClass(document.documentElement,'tinyViewport')?0:g('pagelet_bluebar').offsetTop+g('pagelet_bluebar').offsetHeight;}aa.defer();Event.listen(window,'resize',x(aa));v(z.prototype,{findTop:function(){var ba=j.scry(this.root,'li.uiStreamStory');for(var ca=0;ca<ba.length;ca++)if(t.getElementPosition(ba[ca]).y>t.getScrollPosition().y)return ba[ca];},onLeave:function(){this.keydownListener&&this.keydownListener.remove();this.focusinListener&&this.focusinListener.remove();this.navigationListener&&h.unsubscribe(this.navigationListener);},init:function(){q.onLeave(this.onLeave.bind(this));this.navigationListener=h.subscribe(o.NAVIGATION_BEGIN,this.onLeave.bind(this));this.keydownListener=Event.listen(document,'keydown',function(ba){var ca=Event.getKeyCode(ba);if(ba.getModifiers().any)return true;var da=this.getParentStory(document.activeElement);if((ca!=n.J)&&(ca!=n.K)&&!da)return true;if(this.isInteractive(document.activeElement))return true;switch(ca){case n.DOWN:case n.J:this.vert(1);break;case n.UP:case n.K:this.vert(-1);break;case n.L:this.click('.UFILikeLink');break;case n.C:this.click('.comment_link');break;case n.RETURN:if(this.selected.id=='pagelet_composer'){var ea=j.scry(this.selected,'textarea')[0];ea&&m.focus(ea);}else this.click('.comment_link');break;default:return;}this.hasUsedKeyboard=true;ba.preventDefault();}.bind(this));this.focusinListener=Event.listen(document,'focusin',function(ba){var ca=ba.getTarget(),da=this.getParentStory(ca);if(da&&(this.selected!=da)){this.setSelected(da);if(!this.isInteractive(ca))this.setFocused(da);}}.bind(this));},click:function(ba){if(this.selected){var ca=l.scry(this.selected,ba);if((ca.length==1)&&i.shown(ca[0]))ca[0].click();}},vert:function(ba){if(!this.selected){this.setSelected(this.findTop());this.setFocused(this.findTop());return;}var ca;if(this.selected.id=='pagelet_composer'){ca=ba>0?l.scry(this.root,'li.uiStreamStory')[0]:null;}else ca=ba>0?this.selected.nextSibling:(this.selected.previousSibling||w('pagelet_composer'));if(!ca){return;}else if(!l.isElementNode(ca)){i.removeClass(this.selected,'selectedStorySimple');this.selected=ca;return this.vert(ba);}var da=Math.min(Math.abs(t.getElementPosition(ca).y-u.getTop()-document.body.scrollTop),400);this.anim&&this.anim.stop();var ea=(Date.now()-(this.lastScroll||0)>30);this.anim=k.scrollTo(ca,ea?da:0,false,t.getViewportDimensions().y-y-10,this.setFocused.bind(this,ca));this.setSelected(ca);this.lastScroll=Date.now();},setSelected:function(ba){var ca=l.scry(ba,'.selectedStoryIndicator');if(!ca.length)j.prependContent(ba,j.create('div',{'class':'selectedStoryIndicator'}));this.selected&&this.setTabindexOnHeadline(this.selected,"-1");this.setTabindexOnHeadline(ba,"0");this.selected&&i.removeClass(this.selected,'selectedStorySimple');this.selected=ba;i.addClass(this.selected,'selectedStorySimple');},getParentStory:function(ba){return p.byClass(ba,"uiStreamStory");},getHeadline:function(ba){return l.scry(ba,'h5.uiStreamHeadline')[0];},isInteractive:function(ba){return ((ba.nodeName=="INPUT")||(ba.nodeName=="TEXTAREA")||(ba.nodeName=="A")||p.byAttribute(ba,"contenteditable"));},setTabindexOnHeadline:function(ba,ca){if(i.hasClass(ba,"uiStreamStory")){var da=this.getHeadline(ba);if(da)da.tabIndex=ca;}},setFocused:function(ba){if(i.hasClass(ba,"uiStreamStory")){var ca=this.getHeadline(ba);ca&&m.focus(ca);}}});e.exports=z;});
__d("FeedTrackingAsync",["event-extensions","collectDataAttributes","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('collectDataAttributes'),h=b('copyProperties');function i(j){Event.listen(j,'AsyncRequest/send',function(event){var k=event.getTarget(),l=event.getData().request,m=l.getData(),n=g(k,['ft']);h(m,n);});}e.exports={init:i};});
function StreamPageletCacheController(a,b){this.parent.construct(this,a,b,[]);}Class.extend(StreamPageletCacheController,'PageletCacheController');copyProperties(StreamPageletCacheController.prototype,{getControllerDataOnSnapshot:function(a){return {newest:a.getNewest()};},updateAfterload:function(a){a.loadNewer();}});
__d("collectSubtreeData",[],function(a,b,c,d,e,f){function g(i,j,k,l,m){if(i.offsetWidth===0&&i.offsetHeight===0)return m;var n={};if(i.getAttribute)for(r=0;r<j.length;r++){t=j[r];var o=i.getAttribute(k[t]);if(o){n[t]={};var p=JSON.parse(o);for(var q in l)if(p[q]!==undefined){n[t][q]=true;if(m[t]===undefined)m[t]={};if(m[t][q]===undefined)m[t][q]=[];if(l[q].length>0)m[t][q].push(l[q]);m[t][q].push('('+p[q]);}}}for(var r=0;r<i.childNodes.length;r++){var s=i.childNodes[r];g(s,j,k,l,m);}for(var t in n)for(var u in n[t]){var v=m[t][u][m[t][u].length-1];if(v.length>0&&v.charAt(0)=='('){m[t][u][m[t][u].length-1]=v.substr(1);}else m[t][u].push(')');}return m;}function h(i,j){var k={};for(var l=0;l<j.length;++l)k[j[l]]='data-'+j[l];var m={tn:"","tn-debug":","},n={};g(i,j,k,m,n);for(var o in n)for(var p in n[o])n[o][p]=n[o][p].join('');return n;}e.exports=h;});
__d("ViewportTracking",["event-extensions","Arbiter","DOM","NavigationMessage","Run","Style","UIIntentionalStreamMessage","Vector","$","clickRefAction","collectSubtreeData","copyProperties","debounce"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Arbiter'),h=b('DOM'),i=b('NavigationMessage'),j=b('Run'),k=b('Style'),l=b('UIIntentionalStreamMessage'),m=b('Vector'),n=b('$'),o=b('clickRefAction'),p=b('collectSubtreeData'),q=b('copyProperties'),r=b('debounce'),s='vpv';function t(){}q(t.prototype,{init:function(u){q(this,{readStoryIDs:{},minSizeToBeVisible:200,listeners:[],arbiterSubscriptions:[]});this.getDataFromConfig(u);this.fireTimer();var v=r(this.fireTimer,this.getTimeout(),this);this.listeners.push(Event.listen(window,'scroll',v));this.listeners.push(Event.listen(window,'resize',v));this.arbiterSubscriptions.push(g.subscribe(l.UPDATE_HTML_CONTENT,v));j.onLeave(this.cleanup.bind(this));this.arbiterSubscriptions.push(g.subscribe(i.NAVIGATION_BEGIN,this.cleanup.bind(this)));},cleanup:function(){this.listeners.forEach(function(u){u.remove();});this.listeners=[];this.arbiterSubscriptions.forEach(function(u){u.unsubscribe();});this.arbiterSubscriptions=[];},fireTimer:function(){this.getStoriesInView().forEach(this.markStoryRead.bind(this));},getStoriesInView:function(){var u=this.getAllStories(),v=[],w=false;for(var x=0;x<u.length;x++){var y=u[x],z=this.getStoryID(y);if(this.hasBeenVisible(z))continue;if(this.isVisible(y)){v.push(y);w=true;}else if(w)break;}return v;},hasBeenVisible:function(u){return u in this.readStoryIDs;},isVisible:function(u){var v=m.getViewportDimensions(),w=m.getElementPosition(u,'viewport'),x=m.getElementDimensions(u),y=Math.max(w.y,0),z=Math.min(w.y+x.y,v.y),aa=Math.min(x.y,this.minSizeToBeVisible);return (z-y)>=aa;},markStoryRead:function(u){var v=this.getStoryID(u);if(!v)return;if(!this.hasBeenVisible(v)){this.readStoryIDs[v]=true;var w=this.getDataToLog(u);o(s,u,null,'FORCE',w);}}});e.exports=t;});
__d("StreamViewportTracking",["event-extensions","Arbiter","Class","DOM","NavigationMessage","Run","Style","UIIntentionalStreamMessage","Vector","ViewportTracking","$","collectSubtreeData","copyProperties","debounce","ge"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Arbiter'),h=b('Class'),i=b('DOM'),j=b('NavigationMessage'),k=b('Run'),l=b('Style'),m=b('UIIntentionalStreamMessage'),n=b('Vector'),o=b('ViewportTracking'),p=b('$'),q=b('collectSubtreeData'),r=b('copyProperties'),s=b('debounce'),t=b('ge'),u=51;function v(){this.parent.construct(this);}h.extend(v,o);r(v.prototype,{getDataFromConfig:function(w){this.recordTNTree=w.record_tn_tree;this.timeout=w.record_delay;},getTimeout:function(){return this.timeout;},getAllStories:function(){return i.scry(p('home_stream'),'.uiStreamStory');},getStoryID:function(w){var x=JSON.parse(w.getAttribute('data-ft'));return x.mf_story_key;},getDataToLog:function(w){var x={evt:u};if(this.recordTNTree){var y=q(w,['ft']);for(var z in y.ft){x[z+'_tree']=y.ft[z];if(z==='tn-debug')w.setAttribute('tn-debug_subtree',y.ft[z]);}x.evt_value=w.offsetHeight;var aa=t('home_stream');if(aa)x.offset=Math.max(0,w.offsetTop-aa.offsetTop);}return {ft:x};}});e.exports.init=function(w){(new v()).init(w);};});
PageletCache=window.PageletCache||{init:function(){try{PageletCache._cache=window.sessionStorage;}catch(a){}},_processBeforeWrite:function(a){Bootloader.setResourceMap(a.resource_map);var b=(a.css||[]).concat(a.js||[]);for(var c in (a.bootloadable||{}))b.concat(a.bootloadable[c]);a.resource_map=a.resource_map||{};for(var d=0;d<b.length;d++){var e=b[d];if(!a.resource_map[e])a.resource_map[e]=Bootloader.resolveResources([e])[0];}if(a.cache_type=='overwrite'){delete a.onload;delete a.onafterload;delete a.jscc_map;delete a.jsmods;}},write:function(a,b){if(!PageletCache._cache)return;if(a.cacheable){var c={};copyProperties(c,a);delete c.content;PageletCache._pagelets[c.id]=c;PageletCache.subscribeToInstantiateController(c,b);}else if(a.cache_parent)PageletCache._merge(PageletCache._pagelets[a.cache_parent],a);},_merge:function(a,b){for(var c in b){if(typeof b[c]!='object')continue;if(!a[c]){a[c]=b[c];}else if(c=='jsmods'){PageletCache._merge(a.jsmods,b.jsmods);}else if(Array.isArray(b[c])){a[c]=a[c].concat(b[c]);}else copyProperties(a[c],b[c]);}if(a.provides&&a.requires){a.requires=a.requires.filter(function(d){return a.provides.indexOf(d)<0;});a.requires.length||delete a.requires;}if(a.display_dependency){a.display_dependency=a.display_dependency.filter(function(d){return d!=a.id;});a.display_dependency.length||delete a.display_dependency;}delete a.content;},updateSnapshot:function(a,b,c){var d=PageletCache._pagelets[a];d.content={};d.content[a]=b.innerHTML;d.__data=c;var e=this.getAndParse(d.id);try{PageletCache._processBeforeWrite(d);e[d.key]=d;PageletCache._cache.setItem(d.id,JSON.stringify(e));}catch(f){}},fetchData:function(a){var b=PageletCache._pagelets[a].__data;return b?b:{};},loadFromCache:function(a,b){var c={};copyProperties(c,PageletCache.read(a));if(is_empty(c))return a;c.id=a.id;c.cache_hit=true;c.display_dependency=a.display_dependency;c.phase=a.phase;c.is_last=a.is_last;this.subscribeToInstantiateController(c,b);return c;},read:function(a){if(!PageletCache._cache)return null;var b=a.id;if(b.substr(0,6)=='cached')b=b.substr(7);var c=this.getAndParse(b);if(c&&c[a.key]){PageletCache._pagelets[b]=c[a.key];PageletCache._cache_hits[b]=true;return c[a.key];}if(a.cache_type=='update')Bootloader.loadComponents(['UIPagelet','uri'],function(){UIPagelet.loadFromEndpoint(a.controller_class,b,URI.getNextURI().getQueryData(),{usePipe:true,pageletCacheMiss:a,automatic:true});});return null;},getAndParse:function(a){var b=PageletCache._cache.getItem(a);if(b)try{return JSON.parse(b);}catch(c){}return {};},isCacheHit:function(a){return !!PageletCache._cache_hits[a];},cleanup:function(a){delete PageletCache._cache_hits[a];delete PageletCache._pagelets[a];},subscribeToInstantiateController:function(a,b){var c=b.subscribe('pagelet_event',function(d,e){if(e.id==a.id&&e.event=='preonload'){c.unsubscribe();new window[a.cache_controller](a.id,a.cache_type);}});},_cache:null,_pagelets:{},_cache_hits:{}};
function PageletCacheController(a,b,c){if(!PageletCache)return;if(!a)return;this._cacheKey=a;this._cacheType=b;this._subscriptions=[];this._controller=null;this._registerSnapshot(c);PageletCacheController._instances[a]=this;}copyProperties(PageletCacheController,{registerController:function(a,b){if(!a||!b)return null;var c=PageletCacheController._instances[a];if(c){c.setController(b);c.takeSnapshot();if(c._cacheType=='update'&&PageletCache.isCacheHit(a))onafterloadRegister_DEPRECATED(c.updateAfterload.bind(c,b));}return c;},_instances:{}});copyProperties(PageletCacheController.prototype,{registerCleanup:function(a){this._subscriptions.push(Arbiter.subscribe(a,this._cleanup.bind(this)));},setController:function(a){this._controller=a;return this;},loadData:function(){return PageletCache.fetchData(this._cacheKey);},takeSnapshot:function(){var a=$(this._cacheKey).cloneNode(true);this.handlePageletDOMOnSnapshot(a);var b=this.getControllerDataOnSnapshot(this._controller);PageletCache.updateSnapshot(this._cacheKey,a,b);},getControllerDataOnSnapshot:emptyFunction,handlePageletDOMOnSnapshot:emptyFunction,updateAfterload:emptyFunction,_registerSnapshot:function(a){for(var b=0;b<a.length;b++)this._subscriptions.push(Arbiter.subscribe(a[b],this.takeSnapshot.bind(this)));},_cleanup:function(){this._subscriptions.forEach(Arbiter.unsubscribe);this._subscriptions.length=0;PageletCache.cleanup(this._cacheKey);delete PageletCacheController._instances[this._cacheKey];}});
__d("legacy:UIIntentionalStreamRefresh",["UIIntentionalStreamRefresh"],function(a,b,c,d){a.UIIntentionalStreamRefresh=b('UIIntentionalStreamRefresh');},3);